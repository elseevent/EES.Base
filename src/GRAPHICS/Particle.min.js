(function(n){n.using(["E$.structs.Vector2","E$.structs.Range","E$.structs.Rect","E$.graphics.Texture2D"],function(t,i,r){n.namespace("E$.graphics",function(u){function h(n){return n}function f(){return t.ORIGIN}var e=n.klass({ctor:function(){},position:t.ORIGIN,scale:t.ORIGIN,angle:0,velocity:t.ORIGIN,gravityVelocity:t.ORIGIN,rotateVelocity:0,isAlive:function(n){return n=n||r.NONE,n.hitTest(this.position)},update:function(){this.position=this.position.addition(this.velocity);this.velocity=this.velocity.addition(this.gravityVelocity);this.angle+=this.rotateVelocity;n(this).dispatch("onUpdate",this)}}),o=n.klass({ctor:function(t){this.emitArea=t.emitArea;this.aliveBound=t.aliveBound;this.positionFactory=t.positionFactory;this.particleScaleFactory=t.particleScaleFactory;this.particleAngleFactory=t.particleAngleFactory;this.particleVelocityFactory=t.particleVelocityFactory;this.particleGravityVelocityFactory=t.particleGravityVelocityFactory;this.particlePool=new n.components.collections.List},emitArea:r.NONE,aliveBound:r.NONE,positionFactory:f,particleScaleFactory:f,particleAngleFactory:h,particleVelocityFactory:f,particleGravityVelocityFactory:f,enabled:!0,particlePool:null,emit:function(){if(this.enabled){var t=this,i=new e;return i.rotateVelocity=t.particleAngleFactory(),i.position=t.positionFactory(t.emitArea),i.scale=t.particleScaleFactory(),i.velocity=t.particleVelocityFactory(),i.gravityVelocity=t.particleGravityVelocityFactory(),t.particlePool.add(i),n(i).addListener("onUpdate",function(n){n.isAlive(t.aliveBound)||t.particlePool.remove(n)}),i}},getPoolAspect:function(){return this.particlePool.toArray()||[]},destroy:function(){this.particlePool.clear();delete this.particlePool;this.particlePool=null}}),s=n.klass({ctor:function(n){this.renderContext=n.renderContext;this.renderTexture=n.renderTexture;this.renderBound=n.renderBound},enabled:!0,renderContext:null,renderTexture:null,renderBound:r.NONE,render:function(n){var f;if(this.enabled){var o=this,t=this.renderContext,u=this.renderBound;for(t.clearRect(u.position.x,u.position.y,u.size.x,u.size.y),f=0;f<n.length;f++){var r=n[f],i=o.getRandomTexture(),e=i.scaleTo(r.scale);r.update();t.save();t.translate(r.position.x,r.position.y);t.rotate(r.angle);t.drawImage(i.image,i.offset.x,i.offset.y,i.size.x,i.size.y,-e.x/2,-e.y/2,e.x,e.y);t.restore()}}},getRandomTexture:function(){return this.renderTexture[Math.floor(n.randomRange(0,this.renderTexture.length))]},destroy:function(){delete this.renderContext;delete this.renderTexture;this.renderContext=null;this.renderTexture=null}}),c=function(n){var t=n.emiter.getPoolAspect();n.renderer.render(t)},l=function(n){n.emiter.emit()},a=n.klass({ctor:function(n){var t=this;t.emiter=new o(n.emiter);t.renderer=new s(n.renderer)},emiter:null,renderer:null,start:function(n,t){this.renderId=setInterval(c,1e3/(n||30),this);this.emitId=setInterval(l,t||100,this);this.emiter.enabled=!0;this.renderer.enabled=!0},stop:function(){this.emiter.enabled=!1;this.renderer.enabled=!1;clearInterval(this.renderId);clearInterval(this.emitId)},destroy:function(){(this.emiter.enabled||this.renderer.enabled)&&this.stop();this.emiter.destroy();this.renderer.destroy();delete this.emiter;delete this.renderer}});n.extends(u,{Particle:e,ParticleEmiter:o,ParticleRenderer:s,ParticleSystem:a})})})})(EES);